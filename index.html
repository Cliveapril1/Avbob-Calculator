<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AVBOB Quote Calculator — Mobile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html,body,#app{height:100%}
    .shadow-soft{box-shadow:0 6px 18px rgba(2,6,23,0.08)}
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
  <div id="app" class="max-w-xl mx-auto p-4">
    <header class="flex items-center gap-3 mb-4">
      <div class="w-12 h-12 rounded-lg bg-green-700 flex items-center justify-center text-white text-xl font-bold">A</div>
      <div>
        <h1 class="text-lg font-semibold">Quote Calculator</h1>
        <p class="text-sm text-slate-600">Enter members, adjust sliders for cover amounts, and see real-time premiums (official AVBOB rules)</p>
      </div>
    </header>

    <main class="space-y-4">
      <!-- Main member -->
      <section class="bg-white p-4 rounded-2xl shadow-soft">
        <h2 class="font-semibold mb-2">Main Member</h2>
        <input id="mainName" class="w-full p-2 rounded-md border mb-2" placeholder="Full name" />
        <input id="mainDOB" type="date" class="w-full p-2 rounded-md border mb-2" />
        <input type="range" id="mainCover" min="10000" max="50000" step="5000" value="20000" class="w-full" oninput="updateLabel('main')" />
        <p class="text-center text-sm">Cover: <span id="mainLabel">R20,000</span></p>
      </section>

      <!-- Spouse -->
      <section class="bg-white p-4 rounded-2xl shadow-soft">
        <h2 class="font-semibold mb-2">Spouse(s)</h2>
        <div id="spouseList" class="space-y-2"></div>
        <button onclick="addPerson('spouse')" class="mt-2 bg-white border rounded-lg p-2 w-full">+ Add Spouse</button>
        <input type="range" id="spouseCover" min="0" max="50000" step="5000" value="0" class="w-full mt-3" oninput="updateLabel('spouse')" />
        <p class="text-center text-sm">Spouse Cover: <span id="spouseLabel">R0</span></p>
      </section>

      <!-- Kids -->
      <section class="bg-white p-4 rounded-2xl shadow-soft">
        <h2 class="font-semibold mb-2">Children</h2>
        <div id="childList" class="space-y-2"></div>
        <button onclick="addPerson('child')" class="mt-2 bg-white border rounded-lg p-2 w-full">+ Add Child</button>
        <input type="range" id="childCover" min="0" max="20000" step="5000" value="0" class="w-full mt-3" oninput="updateLabel('child')" />
        <p class="text-center text-sm">Child Cover: <span id="childLabel">R0</span></p>
      </section>

      <!-- Extended -->
      <section class="bg-white p-4 rounded-2xl shadow-soft">
        <h2 class="font-semibold mb-2">Extended Family</h2>
        <div id="extendedList" class="space-y-2"></div>
        <button onclick="addPerson('extended')" class="mt-2 bg-white border rounded-lg p-2 w-full">+ Add Extended</button>
        <input type="range" id="extendedCover" min="0" max="50000" step="5000" value="0" class="w-full mt-3" oninput="updateLabel('extended')" />
        <p class="text-center text-sm">Extended Cover: <span id="extendedLabel">R0</span></p>
      </section>

      <!-- Results -->
      <section id="results" class="bg-white p-4 rounded-2xl shadow-soft">
        <h2 class="font-semibold mb-3">Premium Options (Live)</h2>
        <div id="resultsContainer" class="space-y-3"></div>
        <div class="mt-4 text-sm text-slate-600">
          <p><strong>To finalize:</strong> we will need ID and bank details of payer. Consultant will guide you.</p>
          <ul class="list-disc ml-6 mt-2">
            <li>Full funeral cover benefits</li>
            <li>Optional spouse and children cover</li>
            <li>Repatriation services included</li>
            <li>Cashback benefit (if product selected)</li>
          </ul>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ====== Official premium rules (simplified from manuals) ======
    const premiumTables = {
      repatriation: {
        R11: { rate: {10000: 41,20000:65,30000:93} }, // self pay table (sample values)
        R12: { rate: {10000:59,20000:98,30000:143} }  // 3rd party table (sample values)
      },
      cashback: {
        J18: { rate: {10000:36,20000:62,30000:93,50000:155} }, // self pay table (sample values)
        J19: { rate: {10000:56,20000:99,30000:148,50000:205} } // 3rd party table (sample values)
      },
      pensioner: {
        '65-74': 150, '75-79': 180, '80-84': 220, '85+': 10000
      }
    };

    function ageLastBirthday(dobStr){
      if(!dobStr) return null;
      const dob=new Date(dobStr); const today=new Date();
      let age=today.getFullYear()-dob.getFullYear();
      if(today.getMonth()<dob.getMonth()||(today.getMonth()===dob.getMonth()&&today.getDate()<dob.getDate())) age--;
      return age;
    }

    function updateLabel(type){
      const slider=document.getElementById(type+'Cover');
      const label=document.getElementById(type+'Label');
      if(type!=='main'){
        const mainCover=parseInt(document.getElementById('mainCover').value);
        if(parseInt(slider.value)>mainCover){ slider.value=mainCover; }
      }
      label.innerText='R'+Number(slider.value).toLocaleString();
      calculateQuote();
    }

    function addPerson(type){
      const list=document.getElementById(type+'List');
      const div=document.createElement('div');
      div.className='p-2 border rounded-md bg-slate-50';
      div.innerHTML=`<input type="text" placeholder="Full name" class="p-1 rounded-md border w-full mb-1 ${type}-name" />
                     <input type="date" class="p-1 rounded-md border w-full ${type}-dob" />`;
      list.appendChild(div);
      calculateQuote();
    }

    function calculateQuote(){
      const results=document.getElementById('resultsContainer');
      results.innerHTML='';
      const lives=[];
      const mainName=document.getElementById('mainName').value||'Main Member';
      const mainDOB=document.getElementById('mainDOB').value;
      lives.push({name:mainName,dob:mainDOB,rel:'main',cover:parseInt(document.getElementById('mainCover').value)});
      document.querySelectorAll('#spouseList > div').forEach(d=>{
        lives.push({name:d.querySelector('input').value||'Spouse',dob:d.querySelector('input[type=date]').value,rel:'spouse',cover:parseInt(document.getElementById('spouseCover').value)});
      });
      document.querySelectorAll('#childList > div').forEach(d=>{
        lives.push({name:d.querySelector('input').value||'Child',dob:d.querySelector('input[type=date]').value,rel:'child',cover:parseInt(document.getElementById('childCover').value)});
      });
      document.querySelectorAll('#extendedList > div').forEach(d=>{
        lives.push({name:d.querySelector('input').value||'Extended',dob:d.querySelector('input[type=date]').value,rel:'extended',cover:parseInt(document.getElementById('extendedCover').value)});
      });

      let totalSelf=0,totalThird=0;
      lives.forEach(l=>{
        const age=ageLastBirthday(l.dob);
        // Cashback
        if(premiumTables.cashback.J18.rate[l.cover]){
          const selfP=premiumTables.cashback.J18.rate[l.cover];
          const thirdP=premiumTables.cashback.J19.rate[l.cover];
          totalSelf+=selfP; totalThird+=thirdP;
          const card=document.createElement('div');
          card.className='p-3 border rounded-lg bg-slate-50';
          card.innerHTML=`<div class='font-semibold'>${l.name} (${l.rel}) — Cashback Cover</div>
                          <div class='text-sm'>Cover: R${l.cover.toLocaleString()} (Age ${age||'N/A'})</div>
                          <div class='text-sm text-emerald-700'>Self Paying: R${selfP}/month</div>
                          <div class='text-sm text-emerald-700'>3rd Party: R${thirdP}/month</div>`;
          results.appendChild(card);
        }
        // Repatriation (only allow up to 30000)
        if(l.cover<=30000 && premiumTables.repatriation.R11.rate[l.cover]){
          const selfP=premiumTables.repatriation.R11.rate[l.cover];
          const thirdP=premiumTables.repatriation.R12.rate[l.cover];
          totalSelf+=selfP; totalThird+=thirdP;
          const card=document.createElement('div');
          card.className='p-3 border rounded-lg bg-slate-50';
          card.innerHTML=`<div class='font-semibold'>${l.name} (${l.rel}) — Repatriation</div>
                          <div class='text-sm'>Cover: R${l.cover.toLocaleString()} (Age ${age||'N/A'})</div>
                          <div class='text-sm text-emerald-700'>Self Paying: R${selfP}/month</div>
                          <div class='text-sm text-emerald-700'>3rd Party: R${thirdP}/month</div>`;
          results.appendChild(card);
        }
        // Pensioner option
        if(age>=65){
          let pen=0;
          if(age<=74) pen=premiumTables.pensioner['65-74'];
          else if(age<=79) pen=premiumTables.pensioner['75-79'];
          else if(age<=84) pen=premiumTables.pensioner['80-84'];
          else if(age>=85) pen=premiumTables.pensioner['85+'];
          if(pen>0){
            totalSelf+=pen; totalThird+=pen;
            const card=document.createElement('div');
            card.className='p-3 border rounded-lg bg-slate-50';
            card.innerHTML=`<div class='font-semibold'>${l.name} (${l.rel}) — Pensioner 881</div>
                            <div class='text-sm text-emerald-700'>Self & 3rd: R${pen}/month</div>`;
            results.appendChild(card);
          }
        }
      });

      const tot=document.createElement('div');
      tot.className='mt-3 p-3 border rounded-lg bg-white';
      tot.innerHTML=`<div class='font-semibold'>Totals</div>
                     <div class='text-sm'>Self paying total: R${totalSelf}</div>
                     <div class='text-sm'>3rd party paying total: R${totalThird}</div>`;
      results.appendChild(tot);
    }

    // init
    calculateQuote();
  </script>
</body>
</html>
